openapi: 3.0.3
info:
  title: Vulnerable Auction Lab API
  description: |
    REST API for the Vulnerable Auction Lab — an educational microservices auction platform
    with **intentional security vulnerabilities** (SQL injection, XSS, weak JWT, missing auth
    checks, IDOR, permissive CORS). These vulnerabilities exist for security training purposes.
  version: 1.0.0
  contact:
    name: Auction Lab

servers:
  - url: https://hkku6t3qsd.execute-api.us-east-1.amazonaws.com/dev/api
    description: Production (AWS Lambda)
  - url: http://localhost:3001/api
    description: Local development

tags:
  - name: Auth
    description: Authentication (register, login, verify)
  - name: Auctions
    description: Auction CRUD, closing, and workflow management
  - name: Bids
    description: Bid placement and payment status
  - name: Orders
    description: Order management for completed auctions
  - name: Disputes
    description: Dispute filing and resolution
  - name: Users
    description: User profiles and activity
  - name: Health
    description: Service health check

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT token obtained from /auth/login. Weak secret and no expiration (intentional vulnerability).
        Token can also be passed in the request body as `token` field.

  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
        email:
          type: string
          format: email
        password:
          type: string
          description: Bcrypt hash — intentionally exposed (vulnerability)
        name:
          type: string
        role:
          type: string
          enum: [user, admin, seller]
        phone:
          type: string
          nullable: true
        address:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time

    Auction:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
        description:
          type: string
        starting_price:
          type: number
          format: decimal
        current_bid:
          type: number
          format: decimal
        end_time:
          type: string
          format: date-time
        status:
          type: string
          enum: [active, ended, cancelled]
        workflow_state:
          type: string
          enum: [active, pending_sale, shipping, complete]
        created_by:
          type: integer
          description: User ID of creator
        winner_id:
          type: integer
          nullable: true
        closed_at:
          type: string
          format: date-time
          nullable: true
        created_at:
          type: string
          format: date-time

    AuctionWithBids:
      allOf:
        - $ref: '#/components/schemas/Auction'
        - type: object
          properties:
            bids:
              type: array
              items:
                $ref: '#/components/schemas/Bid'

    AuctionDetail:
      allOf:
        - $ref: '#/components/schemas/Auction'
        - type: object
          properties:
            bids:
              type: array
              items:
                $ref: '#/components/schemas/Bid'
            creator:
              type: object
              properties:
                id:
                  type: integer
                email:
                  type: string
                name:
                  type: string
            order:
              $ref: '#/components/schemas/Order'
              nullable: true

    Bid:
      type: object
      properties:
        id:
          type: integer
        auction_id:
          type: integer
        user_id:
          type: integer
        amount:
          type: number
          format: decimal
        payment_status:
          type: string
          default: pending
        created_at:
          type: string
          format: date-time

    BidWithUser:
      allOf:
        - $ref: '#/components/schemas/Bid'
        - type: object
          properties:
            user:
              type: object
              properties:
                id:
                  type: integer
                email:
                  type: string
                name:
                  type: string

    Order:
      type: object
      properties:
        id:
          type: integer
        auction_id:
          type: integer
        buyer_id:
          type: integer
        seller_id:
          type: integer
        winning_bid_id:
          type: integer
          nullable: true
        total_amount:
          type: number
          format: decimal
        payment_status:
          type: string
          default: pending
        shipping_address:
          type: string
        shipping_status:
          type: string
          enum: [pending, shipped, delivered]
          default: pending
        tracking_number:
          type: string
          nullable: true
        tracking_url:
          type: string
          nullable: true
        status:
          type: string
          enum: [pending_payment, paid, shipped, completed]
          default: pending_payment
        shipped_at:
          type: string
          format: date-time
          nullable: true
        completed_at:
          type: string
          format: date-time
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    OrderWithRelations:
      allOf:
        - $ref: '#/components/schemas/Order'
        - type: object
          properties:
            auction:
              $ref: '#/components/schemas/Auction'
              nullable: true
            buyer:
              $ref: '#/components/schemas/User'
            seller:
              $ref: '#/components/schemas/User'

    Dispute:
      type: object
      properties:
        id:
          type: integer
        auction_id:
          type: integer
        order_id:
          type: integer
          nullable: true
        filed_by:
          type: integer
          description: User ID of the filer
        filed_by_role:
          type: string
          enum: [buyer, seller]
        reason:
          type: string
        status:
          type: string
          enum: [open, in_review, resolved, closed]
          default: open
        resolution:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    DisputeWithRelations:
      allOf:
        - $ref: '#/components/schemas/Dispute'
        - type: object
          properties:
            auction:
              $ref: '#/components/schemas/Auction'
              nullable: true
            filer:
              type: object
              properties:
                id:
                  type: integer
                email:
                  type: string
                name:
                  type: string
            order:
              $ref: '#/components/schemas/Order'
              nullable: true

    Error:
      type: object
      properties:
        error:
          type: string
        message:
          type: string
        stack:
          type: string
          description: Stack trace — intentionally exposed (vulnerability)

paths:
  /health:
    get:
      tags: [Health]
      summary: Service health check
      operationId: healthCheck
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  service:
                    type: string
                    example: database-service

  # ── Auth ──────────────────────────────────────────────

  /auth/register:
    post:
      tags: [Auth]
      summary: Register a new user
      description: |
        Creates a new user account. **Vulnerabilities:** client-provided role accepted,
        password hash returned in response, password logged to console, weak bcrypt rounds (5).
      operationId: register
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password, name]
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                password:
                  type: string
                  example: password123
                name:
                  type: string
                  example: John Doe
                role:
                  type: string
                  enum: [user, admin, seller]
                  default: user
                  description: Client can set any role (vulnerability)
      responses:
        '201':
          description: User created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: User already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /auth/login:
    post:
      tags: [Auth]
      summary: Login and get JWT token
      description: |
        Authenticates user and returns a JWT token with no expiration (vulnerability).
        Password hash is included in the response (vulnerability).
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                password:
                  type: string
                  example: password123
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    description: JWT Bearer token
                  user:
                    $ref: '#/components/schemas/User'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /auth/verify:
    post:
      tags: [Auth]
      summary: Verify JWT token
      operationId: verifyToken
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Token is valid
          content:
            application/json:
              schema:
                type: object
                properties:
                  valid:
                    type: boolean
                    example: true
                  user:
                    $ref: '#/components/schemas/User'
        '401':
          description: Invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found

  # ── Auctions ──────────────────────────────────────────

  /auctions:
    get:
      tags: [Auctions]
      summary: List auctions
      description: Returns all auctions with optional filtering. Each auction includes its bids array.
      operationId: listAuctions
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [active, ended, cancelled]
        - name: search
          in: query
          description: Search title and description (SQL injection vulnerable LIKE query)
          schema:
            type: string
        - name: minPrice
          in: query
          schema:
            type: number
        - name: maxPrice
          in: query
          schema:
            type: number
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
      responses:
        '200':
          description: List of auctions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AuctionWithBids'

    post:
      tags: [Auctions]
      summary: Create an auction
      operationId: createAuction
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [title, description, starting_price, end_time]
              properties:
                title:
                  type: string
                  example: Vintage Rolex Submariner
                description:
                  type: string
                  example: Excellent condition, original box included
                starting_price:
                  type: number
                  example: 1000
                end_time:
                  type: string
                  format: date-time
                  example: '2026-03-01T12:00:00Z'
      responses:
        '201':
          description: Auction created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Auction'
        '401':
          description: Unauthorized

  /auctions/close-expired:
    post:
      tags: [Auctions]
      summary: Close all expired auctions
      description: |
        Closes auctions where end_time has passed. Sets highest bidder as winner.
        **Vulnerability:** no authentication required for this sensitive operation.
      operationId: closeExpiredAuctions
      responses:
        '200':
          description: Expired auctions closed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  closed_count:
                    type: integer
                  auctions:
                    type: array
                    items:
                      $ref: '#/components/schemas/Auction'

  /auctions/workflow:
    get:
      tags: [Auctions]
      summary: Get current user's auctions by workflow state
      description: Returns auctions where the authenticated user is the seller or buyer, filtered by workflow state.
      operationId: getAuctionsByWorkflow
      security:
        - BearerAuth: []
      parameters:
        - name: workflow_state
          in: query
          schema:
            type: string
            enum: [active, pending_sale, shipping, complete]
        - name: role
          in: query
          description: Filter by user's role in the auction
          schema:
            type: string
            enum: [seller, buyer]
      responses:
        '200':
          description: Filtered auctions
          content:
            application/json:
              schema:
                type: array
                items:
                  allOf:
                    - $ref: '#/components/schemas/Auction'
                    - type: object
                      properties:
                        order:
                          $ref: '#/components/schemas/Order'
                          nullable: true
                        bid_count:
                          type: integer
        '401':
          description: Unauthorized

  /auctions/{id}:
    get:
      tags: [Auctions]
      summary: Get auction by ID
      description: Returns auction with bids, creator info, and order (if any).
      operationId: getAuction
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Auction details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuctionDetail'
        '404':
          description: Auction not found

    put:
      tags: [Auctions]
      summary: Update auction
      description: |
        Updates any auction fields. **Vulnerabilities:** no ownership check,
        dynamic field names allow SQL injection.
      operationId: updateAuction
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
      responses:
        '200':
          description: Auction updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Auction'
        '404':
          description: Auction not found

    delete:
      tags: [Auctions]
      summary: Delete auction
      description: |
        Deletes an auction. **Vulnerability:** no ownership check.
      operationId: deleteAuction
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Auction deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  auction:
                    $ref: '#/components/schemas/Auction'
        '404':
          description: Auction not found

  /auctions/{id}/close:
    post:
      tags: [Auctions]
      summary: Close a specific auction
      description: |
        Closes the auction, sets highest bidder as winner, moves workflow to pending_sale.
        **Vulnerability:** no authentication required.
      operationId: closeAuction
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Auction closed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  auction:
                    $ref: '#/components/schemas/Auction'
                  winner_id:
                    type: integer
                    nullable: true
        '404':
          description: Auction not found

  /auctions/{id}/workflow:
    put:
      tags: [Auctions]
      summary: Update auction workflow state
      description: |
        Transitions the auction workflow. Moving to "shipping" or "complete" also
        updates the associated order status. **Vulnerability:** no ownership check.
      operationId: updateWorkflowState
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [workflow_state]
              properties:
                workflow_state:
                  type: string
                  enum: [active, pending_sale, shipping, complete]
      responses:
        '200':
          description: Workflow state updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  auction:
                    $ref: '#/components/schemas/Auction'
        '400':
          description: Invalid workflow state
        '401':
          description: Unauthorized
        '404':
          description: Auction not found

  # ── Bids ──────────────────────────────────────────────

  /auctions/{id}/bids:
    get:
      tags: [Bids]
      summary: List bids for an auction
      operationId: listBids
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: List of bids with user info
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/BidWithUser'

    post:
      tags: [Bids]
      summary: Place a bid
      description: |
        Bid amount must exceed current_bid. Updates auction's current_bid on success.
        **Vulnerabilities:** no rate limiting, race condition between read and write.
      operationId: placeBid
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [amount]
              properties:
                amount:
                  type: number
                  description: Must be greater than current bid
                  example: 500
      responses:
        '201':
          description: Bid placed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Bid'
        '400':
          description: Invalid bid amount or auction not active
        '401':
          description: Unauthorized
        '404':
          description: Auction not found

  /bids/{id}/payment-status:
    put:
      tags: [Bids]
      summary: Update bid payment status
      description: |
        **Vulnerability:** no authentication or ownership check required.
      operationId: updateBidPaymentStatus
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [payment_status]
              properties:
                payment_status:
                  type: string
                  example: paid
      responses:
        '200':
          description: Payment status updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Bid'
        '404':
          description: Bid not found

  # ── Orders ────────────────────────────────────────────

  /orders:
    get:
      tags: [Orders]
      summary: List orders
      description: |
        Returns all orders with optional filters. Includes related auction, buyer, and seller data.
        **Vulnerability:** no authentication required, all orders visible.
      operationId: listOrders
      parameters:
        - name: buyer_id
          in: query
          schema:
            type: integer
        - name: seller_id
          in: query
          schema:
            type: integer
        - name: status
          in: query
          schema:
            type: string
            enum: [pending_payment, paid, shipped, completed]
        - name: payment_status
          in: query
          schema:
            type: string
        - name: shipping_status
          in: query
          schema:
            type: string
            enum: [pending, shipped, delivered]
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
      responses:
        '200':
          description: List of orders
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/OrderWithRelations'

    post:
      tags: [Orders]
      summary: Create an order for a won auction
      description: Authenticated user must be the auction winner.
      operationId: createOrder
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [auction_id, shipping_address]
              properties:
                auction_id:
                  type: integer
                  example: 1
                shipping_address:
                  type: string
                  example: 742 Evergreen Terrace, Springfield, IL 62704
      responses:
        '201':
          description: Order created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '400':
          description: Auction has no winner
        '403':
          description: User is not the auction winner
        '404':
          description: Auction or winning bid not found
        '401':
          description: Unauthorized

  /orders/{id}:
    get:
      tags: [Orders]
      summary: Get order by ID
      description: |
        Returns order with related auction, buyer, and seller data.
        **Vulnerability:** no ownership check (IDOR).
      operationId: getOrder
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Order details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderWithRelations'
        '404':
          description: Order not found

    put:
      tags: [Orders]
      summary: Update order
      description: |
        Updates any order fields. Setting shipping_status to "shipped" auto-sets shipped_at.
        Setting status to "completed" auto-sets completed_at.
        **Vulnerability:** no ownership check.
      operationId: updateOrder
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                shipping_status:
                  type: string
                  enum: [pending, shipped, delivered]
                status:
                  type: string
                  enum: [pending_payment, paid, shipped, completed]
                tracking_number:
                  type: string
                tracking_url:
                  type: string
              additionalProperties: true
      responses:
        '200':
          description: Order updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '400':
          description: No fields to update
        '404':
          description: Order not found

  # ── Disputes ──────────────────────────────────────────

  /disputes:
    get:
      tags: [Disputes]
      summary: List disputes
      description: |
        Returns all disputes with related auction, filer, and order data.
        **Vulnerability:** no authentication required.
      operationId: listDisputes
      parameters:
        - name: auction_id
          in: query
          schema:
            type: integer
        - name: order_id
          in: query
          schema:
            type: integer
        - name: status
          in: query
          schema:
            type: string
            enum: [open, in_review, resolved, closed]
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
      responses:
        '200':
          description: List of disputes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DisputeWithRelations'

    post:
      tags: [Disputes]
      summary: File a dispute
      operationId: createDispute
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [auction_id, reason, filed_by_role]
              properties:
                auction_id:
                  type: integer
                  example: 1
                order_id:
                  type: integer
                  nullable: true
                  example: 1
                reason:
                  type: string
                  example: Item arrived damaged
                filed_by_role:
                  type: string
                  enum: [buyer, seller]
      responses:
        '201':
          description: Dispute created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Dispute'
        '401':
          description: Unauthorized

  /disputes/{id}:
    get:
      tags: [Disputes]
      summary: Get dispute by ID
      description: |
        Returns dispute with related data. **Vulnerability:** no ownership check (IDOR).
      operationId: getDispute
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Dispute details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DisputeWithRelations'
        '404':
          description: Dispute not found

    put:
      tags: [Disputes]
      summary: Update dispute
      description: |
        Update dispute status or resolution. **Vulnerability:** no ownership check (IDOR).
      operationId: updateDispute
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum: [open, in_review, resolved, closed]
                resolution:
                  type: string
      responses:
        '200':
          description: Dispute updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Dispute'
        '404':
          description: Dispute not found

  /disputes/{id}/resolve:
    put:
      tags: [Disputes]
      summary: Resolve a dispute
      operationId: resolveDispute
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [resolution]
              properties:
                resolution:
                  type: string
                  example: Refund issued to buyer. Seller warned about packaging standards.
      responses:
        '200':
          description: Dispute resolved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Dispute'
        '404':
          description: Dispute not found

  # ── Users ─────────────────────────────────────────────

  /users:
    get:
      tags: [Users]
      summary: List all users
      description: |
        Returns all users including password hashes.
        **Vulnerabilities:** no admin check, password hashes exposed.
      operationId: listUsers
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
      responses:
        '200':
          description: List of users
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'

  /users/{id}:
    get:
      tags: [Users]
      summary: Get user by ID
      description: |
        Returns user with bids and auctions. **Vulnerability:** IDOR, password hash exposed.
      operationId: getUser
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: User details
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/User'
                  - type: object
                    properties:
                      bids:
                        type: array
                        items:
                          $ref: '#/components/schemas/Bid'
                      auctions:
                        type: array
                        items:
                          $ref: '#/components/schemas/Auction'
        '404':
          description: User not found

    put:
      tags: [Users]
      summary: Update user
      description: |
        Updates any user fields. If password provided, it's hashed with bcrypt (rounds=5).
        **Vulnerabilities:** no ownership check (IDOR), weak bcrypt, password hash returned.
      operationId: updateUser
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                email:
                  type: string
                  format: email
                password:
                  type: string
                role:
                  type: string
                phone:
                  type: string
                address:
                  type: string
              additionalProperties: true
      responses:
        '200':
          description: User updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: No fields to update
        '404':
          description: User not found

  /users/{id}/my-bids:
    get:
      tags: [Users]
      summary: Get user's bids
      description: |
        Returns all bids placed by the user with auction info.
        **Vulnerability:** IDOR — any user can view any other user's bids.
      operationId: getUserBids
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: User's bids
          content:
            application/json:
              schema:
                type: array
                items:
                  allOf:
                    - $ref: '#/components/schemas/Bid'
                    - type: object
                      properties:
                        auction_title:
                          type: string
                        auction_description:
                          type: string
                        auction_status:
                          type: string
                        auction_end_time:
                          type: string
                          format: date-time

  /users/{id}/my-wins:
    get:
      tags: [Users]
      summary: Get user's won auctions
      description: |
        Returns auctions where the user placed the winning bid.
        **Vulnerability:** IDOR.
      operationId: getUserWins
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: User's wins
          content:
            application/json:
              schema:
                type: array
                items:
                  allOf:
                    - $ref: '#/components/schemas/Bid'
                    - type: object
                      properties:
                        auction_title:
                          type: string
                        auction_description:
                          type: string
                        auction_status:
                          type: string
                        auction_end_time:
                          type: string
                          format: date-time
                        seller_id:
                          type: integer

  /users/{id}/my-auctions:
    get:
      tags: [Users]
      summary: Get user's created auctions
      description: |
        Returns auctions created by the user with bid stats.
        **Vulnerability:** IDOR.
      operationId: getUserAuctions
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: User's auctions
          content:
            application/json:
              schema:
                type: array
                items:
                  allOf:
                    - $ref: '#/components/schemas/Auction'
                    - type: object
                      properties:
                        bid_count:
                          type: integer
                        highest_bid:
                          type: number
                          format: decimal

  /users/{id}/my-sales:
    get:
      tags: [Users]
      summary: Get user's completed sales
      description: |
        Returns completed auctions created by the user with winner and payment info.
        **Vulnerability:** IDOR.
      operationId: getUserSales
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: User's sales
          content:
            application/json:
              schema:
                type: array
                items:
                  allOf:
                    - $ref: '#/components/schemas/Auction'
                    - type: object
                      properties:
                        bid_count:
                          type: integer
                        final_price:
                          type: number
                          format: decimal
                        winner_id:
                          type: integer
                        payment_status:
                          type: string
